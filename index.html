<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Desktop Pet Overlay</title>
  </head>
  <body>
    <div id="boot-loading-screen" class="boot-loading-screen" aria-live="polite">
      <div class="boot-loading-card">
        <p class="boot-loading-title">Desktop Pet Overlay</p>
        <p class="boot-loading-text">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
      </div>
    </div>
    <main class="pet-shell">
      <section id="pet-card" class="pet-card compact">
        <section id="pet-playground" class="pet-playground" aria-label="Pet playground"></section>

        <section id="pet-ui-panel" class="pet-ui-panel hidden" aria-label="Desktop pet controls">
          <section class="chat-panel" aria-label="Pet chat">
            <div class="chat-row">
              <button id="chat-open-btn" type="button">ëŒ€í™”í•˜ê¸°</button>
              <span id="chat-status" class="overlay-status">ëŒ€í™”ì°½ ë‹«í˜</span>
            </div>
            <div class="chat-row chat-row-key">
              <button id="openai-key-toggle-btn" type="button" disabled>API í‚¤ ì„¤ì •</button>
              <span id="openai-key-status" class="overlay-status">API í‚¤ í™•ì¸ ì¤‘...</span>
            </div>
            <div id="openai-key-panel" class="openai-key-panel hidden">
              <label for="openai-api-key-input">OpenAI API Key</label>
              <input id="openai-api-key-input" type="password" placeholder="sk-..." autocomplete="off" />
              <div class="openai-key-actions">
                <button id="openai-key-save-btn" type="button">ì €ì¥</button>
                <button id="openai-key-clear-btn" type="button" class="danger-button">ì‚­ì œ</button>
              </div>
              <p id="openai-key-help" class="openai-key-help">í‚¤ ì €ì¥ ê²½ë¡œ í™•ì¸ ì¤‘...</p>
            </div>
            <div id="chat-box" class="chat-box hidden">
              <div id="chat-log" class="chat-log" aria-live="polite"></div>
              <div class="chat-input-row">
                <input id="chat-input" type="text" maxlength="120" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
                <button id="chat-send-btn" type="button">ë³´ë‚´ê¸°</button>
              </div>
            </div>
          </section>
          <div id="panel-drag-handle" class="panel-drag-handle" title="ë“œë˜ê·¸í•´ì„œ íŒ¨ë„ ì´ë™">â‹®â‹® íŒ¨ë„ ì´ë™</div>
          <div id="pet-face" class="pet-face" aria-hidden="true">ğŸ£</div>
          <h1>Desktop Pet Overlay</h1>
          <p id="stage-text" class="stage-text">Stage: Egg</p>
          <p id="warning-text" class="warning-text">ìƒíƒœ ì–‘í˜¸</p>

          <section class="overlay-control-panel" aria-label="Overlay controls">
            <div class="overlay-row overlay-row-toggle">
              <button id="click-through-toggle-btn" type="button">Click-through: OFF</button>
              <button id="settings-btn" type="button" class="icon-button" title="ì„¤ì •">âš™</button>
              <button id="help-btn" type="button" class="icon-button" title="ë„ì›€ë§">?</button>
              <button id="report-btn" type="button" class="icon-button hidden" title="ì¼ì¼ ë¦¬í¬íŠ¸">R</button>
              <span id="click-through-status" class="overlay-status">ì…ë ¥ ìº¡ì²˜ ì¤‘</span>
            </div>
            <div class="overlay-row overlay-row-character">
              <button id="add-character-btn" type="button">+ ìºë¦­í„°</button>
              <button id="remove-character-btn" type="button">- ìºë¦­í„°</button>
              <span id="character-count" class="overlay-status">ìºë¦­í„° 1</span>
            </div>
            <p id="overlay-hint" class="overlay-hint">ë©”ì¸ ìºë¦­í„°ë¥¼ í´ë¦­í•˜ë©´ UIê°€ ì—´ë¦¬ê³  ë‹¤ì‹œ í´ë¦­í•˜ë©´ ë‹«í™ë‹ˆë‹¤.</p>
            <section id="display-settings-panel" class="display-settings-panel hidden" aria-label="Display settings">
              <label for="display-select">í‘œì‹œ ëª¨ë‹ˆí„°</label>
              <select id="display-select"></select>
              <button id="display-apply-btn" type="button">ëª¨ë‹ˆí„° ì ìš©</button>
              <label for="character-size-slider">ìºë¦­í„° í¬ê¸°</label>
              <div class="settings-inline">
                <input id="character-size-slider" type="range" min="1" max="10" step="1" />
                <span id="character-size-value" class="overlay-status">1 (x1.00)</span>
              </div>
              <label for="main-motion-mode-select">ë©”ì¸ ìºë¦­í„° ì´ë™</label>
              <select id="main-motion-mode-select">
                <option value="random">ëœë¤ ì´ë™</option>
                <option value="fixed">í˜„ì¬ ìœ„ì¹˜ ê³ ì •</option>
              </select>
              <button id="reset-growth-btn" type="button" class="danger-button">
                ì„±ì¥ ë‚´ìš© ì´ˆê¸°í™”
              </button>
            </section>
          </section>

          <section class="activity-panel" aria-label="Activity EXP">
            <div class="activity-row">
              <button id="activity-opt-toggle-btn" type="button">í™œë™ EXP: ON</button>
              <button id="activity-checkin-btn" type="button">EXP íšë“</button>
            </div>
            <p id="activity-status" class="activity-status">í™œë™ëŸ‰ ê¸°ë°˜ EXP ìˆ˜ì§‘ ëŒ€ê¸° ì¤‘</p>
            <p id="activity-metrics" class="activity-status">ì…ë ¥ ì´ë²¤íŠ¸ ì§‘ê³„: 0</p>
            <p id="help-panel" class="help-panel hidden">ë²„íŠ¼ ì•ˆë‚´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
          </section>

          <section class="exp-panel" aria-label="Experience">
            <div class="stat-label-row">
              <span>EXP</span>
              <span id="exp-text">0 / 30</span>
            </div>
            <div class="stat-bar">
              <div id="exp-fill" class="stat-fill exp"></div>
            </div>
          </section>

          <section class="stats-panel" aria-label="Pet stats">
            <div class="stat-item">
              <div class="stat-label-row">
                <span>Hunger</span>
                <span id="hunger-value">100</span>
              </div>
              <div class="stat-bar">
                <div id="hunger-fill" class="stat-fill hunger"></div>
              </div>
            </div>
            <div class="stat-item">
              <div class="stat-label-row">
                <span>Happiness</span>
                <span id="happiness-value">100</span>
              </div>
              <div class="stat-bar">
                <div id="happiness-fill" class="stat-fill happiness"></div>
              </div>
            </div>
            <div class="stat-item">
              <div class="stat-label-row">
                <span>Cleanliness</span>
                <span id="cleanliness-value">100</span>
              </div>
              <div class="stat-bar">
                <div id="cleanliness-fill" class="stat-fill cleanliness"></div>
              </div>
            </div>
            <div class="stat-item">
              <div class="stat-label-row">
                <span>Health</span>
                <span id="health-value">100</span>
              </div>
              <div class="stat-bar">
                <div id="health-fill" class="stat-fill health"></div>
              </div>
            </div>
          </section>

          <div class="action-row">
            <button id="feed-btn" type="button">Feed</button>
            <button id="clean-btn" type="button">Clean</button>
            <button id="play-btn" type="button">Play</button>
          </div>
          <div class="action-row bottom-row">
            <button id="quit-btn" type="button" class="danger-button">ì¢…ë£Œ</button>
          </div>

          <p id="meta-text" class="meta-text">EXP 0 Â· schema v2</p>
        </section>
      </section>
    </main>
    <script>
      (() => {
        const STAGE_FACE_MAP = {
          Egg: 'ğŸ£',
          Baby: 'ğŸ¥',
          Teen: 'ğŸ±',
          Adult: 'ğŸˆ',
        };
        const stageTextEl = document.getElementById('stage-text');
        const faceEl = document.getElementById('pet-face');
        const playgroundEl = document.getElementById('pet-playground');
        try {
          const raw = window.localStorage.getItem('desktop-pet-overlay-save');
          const parsed = raw ? JSON.parse(raw) : null;
          const exp =
            parsed && Number.isFinite(Number(parsed.exp)) ? Math.max(0, Math.floor(Number(parsed.exp))) : 0;
          let derivedStage = 'Egg';
          if (exp >= 180) {
            derivedStage = 'Adult';
          } else if (exp >= 90) {
            derivedStage = 'Teen';
          } else if (exp >= 30) {
            derivedStage = 'Baby';
          }
          const savedStage = derivedStage;
          if (stageTextEl) {
            stageTextEl.textContent = `Stage: ${savedStage}`;
          }
          if (faceEl) {
            faceEl.textContent = STAGE_FACE_MAP[savedStage];
          }
          if (playgroundEl) {
            const preview = document.createElement('button');
            const size = 88;
            const x = Math.max(8, window.innerWidth - size - 48);
            const y = Math.max(8, window.innerHeight - size - 16);
            preview.type = 'button';
            preview.className = 'playground-pet main';
            preview.style.left = `${x}px`;
            preview.style.top = `${y}px`;
            preview.setAttribute('aria-hidden', 'true');
            preview.tabIndex = -1;
            preview.textContent = STAGE_FACE_MAP[savedStage];
            playgroundEl.appendChild(preview);
          }
        } catch {
          // Keep fallback UI.
        }
      })();
    </script>
    <script type="module" src="/code/src/renderer.ts"></script>
  </body>
</html>
