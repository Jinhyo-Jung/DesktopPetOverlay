# 1단계. 용어 정의

1. 상태(Stats): 캐릭터의 생존/컨디션을 수치로 표현한 값입니다(배고픔, 행복, 청결, 건강 등).
2. 성장/진화(Evolution): 일정 조건을 만족하면 캐릭터 단계(알→아기→청년→성체)가 바뀌고 외형/행동이 달라지는 시스템입니다.
3. 현실 시간 진행(Realtime): 앱을 꺼둔 시간도 포함해 실제 시간 흐름에 따라 상태가 변하는 방식입니다.
4. 경험치(EXP): 사용자의 상호작용/활동량에 따라 누적되는 성장 자원입니다.
5. 데스크탑 오버레이(Desktop Overlay): 화면 위에 항상 떠 있는(항상 위/투명 배경) 캐릭터 창을 띄워 다른 앱 위에서도 상호작용 가능한 형태입니다.

---

# 2단계. 목표(에이전트가 구현해야 하는 기능 범위)

## A. 전통 다마고치 핵심(필수)

1. 상태 관리: 배고픔/행복/청결/건강
2. 성장 단계: 알→아기→청년→성체(단계별 외형/행동/애니메이션)
3. 상태 기반 분기: 보살핌 수준(케어 성과)에 따라 성체가 달라짐
4. 상호작용: 터치/클릭, 말/표정 반응
5. 저장/로드: 진행 상태 영속 저장
6. 현실 시간 진행: 실시간으로 상태 변화(오프라인 시간 포함)

## B. 확장 요소(권장)

1. 음악/효과음: 행동/반응에 따른 사운드
2. 날씨/시간대: 낮/밤 + 날씨가 행동/상태 변화에 영향
3. PC 상호작용 기반 성장: “컴퓨터에서 얼마나 열심히 일했는지” → EXP 지급/표시

## C. 데스크탑 오버레이(필수, WindowPet 참고)

* 목적: 캐릭터를 **항상 화면 위에 오버레이**로 띄우고, **드래그 이동 / 클릭 상호작용**을 제공하며, Windows에서 **exe 배포**가 가능해야 합니다.

---

# 3단계. 기능 요구사항 상세(에이전트 지시용)

## 3-1. 상태(Stats) 시스템

1. 상태 항목(최소)

* Hunger(배고픔): 0~100
* Happiness(행복): 0~100
* Cleanliness(청결): 0~100
* Health(건강): 0~100

2. 상태 변화 규칙(기본)

* 시간 경과로 Hunger↓, Cleanliness↓, Happiness↓(완만)
* Hunger/Cleanliness가 낮으면 Health 추가 감소
* 상태가 임계치 이하일 때 “아픔/우울/불결” 등 디버프 표시

3. 사용자 액션(상태 회복)

* Feed(먹이/스낵/물): Hunger 회복
* Clean(배설물 정리/목욕): Cleanliness 회복
* Play/Pet(놀이/쓰다듬기): Happiness 회복
* Cure(치료): Health 회복(조건: sick 상태일 때만)

4. UI 요구

* 상태 게이지 4종 표시(숫자/바)
* 상태 이상 경고(아이콘/알림)

---

## 3-2. 성장·진화(Evolution) 시스템

1. 성장 단계

* Egg → Baby → Teen → Adult

2. 단계별 차이

* 외형(스프라이트/애니메이션 세트) 변경
* 행동/대사/반응 패턴 변경
* 현재 Stage 표시

3. 진화 조건

* “시간 + 케어 점수(CareScore) + EXP” 조합
* CareScore: 일정 기간 평균 상태(4스탯)로 계산
* Adult 분기: CareScore/특정 조건(훈련/행복/청결 등)에 따라 AdultType 결정

4. 결과

* 진화 연출(애니메이션/사운드)
* 진화 로그(선택)

---

## 3-3. 상호작용(Interaction)

1. 터치/클릭

* 캐릭터 클릭: 반응 애니메이션 + 소리 + Happiness 소폭 증가(쿨타임)
* 드래그/쓰다듬기: 추가 반응(선택)

2. 말/표정 반응

* 말풍선 텍스트
* 상태에 따른 표정(배고픔/아픔/더러움 등)

---

## 3-4. 저장/로드(Persistence)

1. 반드시 저장해야 하는 값(최소)

* Stats(4종)
* Stage, AdultType(해당 시)
* EXP(및 Level 선택)
* lastSeenTimestamp(마지막 실행 시간)

2. 로드 시 처리

* lastSeenTimestamp로 오프라인 경과 시간 계산
* 오프라인 동안 상태 변화 적용

---

## 3-5. 현실 시간 진행(Realtime + Offline Progress)

1. 주기

* 실행 중: 주기 Tick(예: 1분/5분)
* 종료 중: 다음 실행 시 오프라인 경과를 한 번에 반영

2. 오프라인 반영 규칙(기본)

* elapsedMinutes 기반으로 Hunger/Cleanliness/Happiness 감소
* 임계치 하회 시 Health 추가 감소
* 과도한 페널티 방지용 상한(예: 최대 N시간까지만 반영) 선택

---

## 3-6. 음악/효과음(Audio)

* 먹이/목욕/치료/진화 효과음
* 상태 경고음(선택)
* 배경음악(BGM): 낮/밤/날씨에 따라 트랙 변경(선택)

---

## 3-7. 날씨/시간대(Time of Day + Weather)

1. 시간대

* Day/Night 구분(로컬 시간)
* 밤에는 수면 모드(상태 소모 감소 등) 선택

2. 날씨

* Weather 상태(맑음/비/눈 등)
* 날씨에 따라 배경/행동/사운드 변화
* 날씨 데이터 소스: 실제 날씨 API 사용 또는 가상 랜덤(설계에서 결정)

---

## 3-8. PC 활동 기반 EXP(PC Activity → EXP)

1. 목적

* 사용자의 PC 활동량을 EXP로 환산하여 성장에 반영
* UI에 현재 EXP 표시

2. 요구 기능

* EXPBar 표시(현재/다음 단계까지)
* EXP 획득: 유저 활동량을 주기적으로 수집해 부여
* EXP는 성장/진화 조건에 포함

3. 정책(에이전트가 설계 시 반드시 명시)

* 측정 항목 선택(예: 활성 시간, 키보드/마우스 입력 빈도, 특정 앱 실행 시간 등)
* 최소 수집 원칙 및 권한/개인정보 고려
* 측정 불가 시 대체 루트(수동 체크인 버튼 등) 선택

---

## 3-9. 데스크탑 오버레이(Desktop Overlay) 요구사항 (WindowPet 참고)

### 3-9-1. 창/레이어링 동작

1. 항상 위(Always on top): 다른 앱 위에 캐릭터가 떠 있어야 함
2. 투명 배경(Transparent background): 캐릭터 스프라이트만 보이도록
3. 작업 표시줄 위 배치(옵션): 캐릭터가 taskbar 위에 그려질 수 있어야 함

### 3-9-2. 상호작용

1. 드래그 이동(Drag): 캐릭터를 픽셀 단위로 자연스럽게 이동 가능
2. 클릭 상호작용(Click): 클릭 시 반응(애니메이션/사운드/상태 변화)
3. 클릭-통과(Click-through) 토글: 필요 시 캐릭터가 마우스 이벤트를 통과시켜 뒤의 앱을 조작 가능

### 3-9-3. 멀티 캐릭터/커스텀

1. 다중 캐릭터: 화면에 여러 캐릭터를 동시에 띄울 수 있어야 함
2. 캐릭터 추가/삭제 UI: 캐릭터 선택 목록에서 추가/제거
3. 커스텀 캐릭터 추가: 사용자가 이미지/애니메이션 리소스를 추가하여 펫으로 사용할 수 있어야 함

### 3-9-4. 설정 창(Settings)

1. 설정 창 제공: 오버레이와 분리된 설정 UI
2. 최소 설정 항목

* Click-through on/off
* Always on top on/off(또는 고정)
* 시작 시 자동 실행(Auto start)
* 언어/테마(선택)
* 애니메이션 상태 선택(Idle/Happy/Sleep 등)

### 3-9-5. 업데이트/배포(Windows 중심)

1. Windows 배포물: 최소 .exe 생성(추가로 .msi 선택)
2. 자동 업데이트(선택): 릴리즈 기반 업데이트 체계(앱 내 업데이트 체크)

### 3-9-6. 성능/안정성

1. 다수 캐릭터 동시 실행 시 성능 저하 최소화
2. 종료/재실행 시 마지막 위치/설정 유지
3. 입력 이벤트 충돌(드래그/클릭/통과) 버그 최소화

---

# 4단계. 구현 우선순위(권장 로드맵)

1. Stats + Tick(실시간/오프라인) + 저장/로드
2. 성장 단계 전환 + 진화 연출
3. 오버레이 기본(투명/항상 위/드래그/클릭)
4. 상호작용(말풍선/표정/사운드)
5. 상태 기반 성체 분기(CareScore)
6. 오버레이 고급(클릭-통과/멀티 캐릭터/설정 창)
7. 오디오, 낮/밤, 날씨
8. PC Activity → EXP
9. 자동 업데이트/설치 패키징(msi 등)

---

# 5단계. 완성 기준(Definition of Done)

* 상태 4종이 UI에 표시되고, 시간에 따라 변하며, 액션으로 회복됩니다.
* 앱을 종료했다가 다시 켜도 상태가 저장되고, 오프라인 경과 시간이 반영됩니다.
* 성장 단계가 순서대로 진행되며, 최종 성체는 케어 점수/조건에 따라 분기됩니다.
* 캐릭터는 데스크탑 오버레이로 항상 위에 표시되며, 투명 배경, 드래그 이동, 클릭 상호작용이 됩니다.
* 클릭-통과 토글, 멀티 캐릭터, 커스텀 캐릭터 추가, 설정 창이 제공됩니다.
* Windows에서 실행 가능한 배포물(.exe)이 생성됩니다.
* EXP가 화면에 표시되고, (정의된) PC 활동량에 따라 누적되어 성장에 영향이 있습니다.

---

# 6단계. 신규 기능 구현 시나리오

결론: Feed/Clean/Play 기능 추가 작업은 구현, 밸런스 검증, 저장 포맷 안정성 점검을 한 흐름으로 수행합니다.

1. 상황

* Feed/Clean/Play 기능을 추가합니다.

2. 권장 순서

* `desktop-pet-dev` -> `pet-balance-simulator` -> `save-migration-guard`

3. 기대 결과

* 기능 구현 완료
* 밸런스 검증 완료
* 저장 포맷 안정성 점검 완료
